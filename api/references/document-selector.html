<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Document Selectors | Hello VuePress</title>
    <meta name="description" content="Just playing around">
    
    
    <link rel="preload" href="/vscode-doc-zh/assets/css/0.styles.0c09eec2.css" as="style"><link rel="preload" href="/vscode-doc-zh/assets/js/app.79cc50a5.js" as="script"><link rel="preload" href="/vscode-doc-zh/assets/js/2.6081b710.js" as="script"><link rel="preload" href="/vscode-doc-zh/assets/js/46.789e9716.js" as="script"><link rel="prefetch" href="/vscode-doc-zh/assets/js/10.dcf0234a.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/11.3443e88c.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/12.33618473.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/13.f5bcdba3.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/14.069ed78b.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/15.8ad5337f.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/16.27611e97.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/17.ae2dc47b.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/18.4a6eb331.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/19.17a60d3f.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/20.7de46031.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/21.84669414.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/22.9afacd9c.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/23.f216dfdc.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/24.0cc96f6f.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/25.be98c8b0.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/26.9406d5cd.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/27.c82f8665.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/28.14ff35c2.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/29.0b9194ef.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/3.3c269ca0.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/30.6c266e85.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/31.71b1efc9.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/32.a260662e.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/33.ebd1b0e9.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/34.8c89ccc9.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/35.8c56c023.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/36.bb77a714.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/37.fff25a6d.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/38.c898d862.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/39.2754f4ea.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/4.8ce84c45.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/40.08340174.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/41.022c4327.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/42.a6524d2e.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/43.8f0dd455.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/44.b23d9f65.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/45.04fcf627.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/47.33d6f209.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/48.135250ff.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/49.3d6d3bb5.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/5.62e47b4c.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/50.44990f04.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/51.6ca0374b.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/52.eb83c9e0.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/53.9a022f02.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/54.7da689eb.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/55.25e75232.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/6.83a6b4a3.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/7.eefd45de.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/8.aa200fb5.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/9.6259a5ab.js">
    <link rel="stylesheet" href="/vscode-doc-zh/assets/css/0.styles.0c09eec2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-navbar"><!----> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/vscode-doc-zh/" class="sidebar-link">首页</a></li><li><a href="/vscode-doc-zh/api/" class="sidebar-link">扩展 API</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="document-selectors"><a href="#document-selectors" aria-hidden="true" class="header-anchor">#</a> Document Selectors</h1> <p>Extensions can filter their features based on document selectors by language, file type, and location. This topic discusses document selectors, document schemes, and what extensions authors should be aware about.</p> <h2 id="text-documents-not-on-disk"><a href="#text-documents-not-on-disk" aria-hidden="true" class="header-anchor">#</a> Text documents not on disk</h2> <p>Not all text documents are stored on disk, for example, newly created documents. Unless specified, a document selector applies to <strong>all</strong> document types. Use the <a href="/api/references/vscode-api#DocumentFilter">DocumentFilter</a> <code>scheme</code> property to narrow down on certain schemes, for example <code>{ scheme: 'file', language: 'typescript' }</code> for TypeScript files that are stored on disk.</p> <h2 id="document-selectors-2"><a href="#document-selectors-2" aria-hidden="true" class="header-anchor">#</a> Document selectors</h2> <p>The Visual Studio Code extension API combines language-specific features, like IntelliSense, with document selectors through the <a href="/api/references/vscode-api#DocumentSelector">DocumentSelector</a> type. They are an easy mechanism to narrow down functionality to a specific language.</p> <p>The snippet below registers a <a href="/api/references/vscode-api#HoverProvider">HoverProvider</a> for TypeScript files and the document selector is the <code>typescript</code> language identifier string.</p> <div class="language-ts extra-class"><pre class="language-ts"><code>vscode<span class="token punctuation">.</span>languages<span class="token punctuation">.</span><span class="token function">registerHoverProvider</span><span class="token punctuation">(</span><span class="token string">'typescript'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function">provideHover</span><span class="token punctuation">(</span><span class="token parameter">doc<span class="token punctuation">:</span> vscode<span class="token punctuation">.</span>TextDocument</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">vscode<span class="token punctuation">.</span>Hover</span><span class="token punctuation">(</span><span class="token string">'For *all* TypeScript documents.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>A document selector can be more than just a language identifier and more complex selectors can use a <a href="/api/references/vscode-api#DocumentFilter">DocumentFilter</a> to filter based on the <code>scheme</code> and file location through a <code>pattern</code> path glob-pattern:</p> <div class="language-ts extra-class"><pre class="language-ts"><code>vscode<span class="token punctuation">.</span>languages<span class="token punctuation">.</span><span class="token function">registerHoverProvider</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span> pattern<span class="token punctuation">:</span> <span class="token string">'**/test/**'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token function">provideHover</span><span class="token punctuation">(</span><span class="token parameter">doc<span class="token punctuation">:</span> vscode<span class="token punctuation">.</span>TextDocument</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">vscode<span class="token punctuation">.</span>Hover</span><span class="token punctuation">(</span><span class="token string">'For documents inside `test`-folders only'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The next snippet uses the <code>scheme</code> filter and combines it with a language identifier. The <code>untitled</code> scheme is for new files that have not yet been saved to disk.</p> <div class="language-ts extra-class"><pre class="language-ts"><code>vscode<span class="token punctuation">.</span>languages<span class="token punctuation">.</span><span class="token function">registerHoverProvider</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span> scheme<span class="token punctuation">:</span> <span class="token string">'untitled'</span><span class="token punctuation">,</span> language<span class="token punctuation">:</span> <span class="token string">'typescript'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token function">provideHover</span><span class="token punctuation">(</span><span class="token parameter">doc<span class="token punctuation">:</span> vscode<span class="token punctuation">.</span>TextDocument</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">vscode<span class="token punctuation">.</span>Hover</span><span class="token punctuation">(</span><span class="token string">'For new, unsaved TypeScript documents only'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="document-scheme"><a href="#document-scheme" aria-hidden="true" class="header-anchor">#</a> Document scheme</h2> <p>The <code>scheme</code> of a document is often overlooked but is an important piece of information. Most documents are saved on disk and extension authors typically assume they are working with a file on disk. For example with a simple <code>typescript</code> selector, the assumption is <strong>TypeScript files on disk</strong>. However, there are scenarios where that assumption is too lax and a more explicit selector like <code>{ scheme: 'file', language: 'typescript' }</code> should be used.</p> <p>The importance of this comes into play when features rely on reading/writing files from/to disk. Check out the snippet below:</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// 👎 too lax</span>
vscode<span class="token punctuation">.</span>languages<span class="token punctuation">.</span><span class="token function">registerHoverProvider</span><span class="token punctuation">(</span><span class="token string">'typescript'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function">provideHover</span><span class="token punctuation">(</span><span class="token parameter">doc<span class="token punctuation">:</span> vscode<span class="token punctuation">.</span>TextDocument</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> size <span class="token punctuation">}</span> <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">statSync</span><span class="token punctuation">(</span>doc<span class="token punctuation">.</span>uri<span class="token punctuation">.</span>fsPath<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ⚠️ what about 'untitled:/Untitled1.ts' or others?</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">vscode<span class="token punctuation">.</span>Hover</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Size in bytes is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>size<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The hover provider above wants to display the size of a document on disk but it fails to check whether the document is actually stored on disk. For example, it could be newly created and not yet saved. The correct way would be to tell VS Code that the provider can only work with files on disk.</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// 👍 only works with files on disk</span>
vscode<span class="token punctuation">.</span>languages<span class="token punctuation">.</span><span class="token function">registerHoverProvider</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span> scheme<span class="token punctuation">:</span> <span class="token string">'file'</span><span class="token punctuation">,</span> language<span class="token punctuation">:</span> <span class="token string">'typescript'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token function">provideHover</span><span class="token punctuation">(</span><span class="token parameter">doc<span class="token punctuation">:</span> vscode<span class="token punctuation">.</span>TextDocument</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> size <span class="token punctuation">}</span> <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">statSync</span><span class="token punctuation">(</span>doc<span class="token punctuation">.</span>uri<span class="token punctuation">.</span>fsPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">vscode<span class="token punctuation">.</span>Hover</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Size in bytes is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>size<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="summary"><a href="#summary" aria-hidden="true" class="header-anchor">#</a> Summary</h2> <p>Documents are usually stored on the file system, but not always: there are untitled documents, cached documents that Git uses, documents from remote sources like FTP, and so forth. If your feature relies on disk access, make sure to use a document selector with the <code>file</code> scheme.</p> <h2 id="next-steps"><a href="#next-steps" aria-hidden="true" class="header-anchor">#</a> Next steps</h2> <p>To learn more about VS Code extensibility model, try these topic:</p> <ul><li><a href="/api/references/extension-manifest">Extension Manifest File</a> - VS Code package.json extension manifest file reference</li> <li><a href="/api/references/contribution-points">Contribution Points</a> - VS Code contribution points reference</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/vscode-doc-zh/assets/js/app.79cc50a5.js" defer></script><script src="/vscode-doc-zh/assets/js/2.6081b710.js" defer></script><script src="/vscode-doc-zh/assets/js/46.789e9716.js" defer></script>
  </body>
</html>
