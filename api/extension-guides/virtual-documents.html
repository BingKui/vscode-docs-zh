<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Virtual Documents | Vscode API 中文文档</title>
    <meta name="description" content="Just playing around">
    
    
    <link rel="preload" href="/assets/css/0.styles.454f99c0.css" as="style"><link rel="preload" href="/assets/js/app.69530766.js" as="script"><link rel="preload" href="/assets/js/2.6081b710.js" as="script"><link rel="preload" href="/assets/js/29.0b9194ef.js" as="script"><link rel="prefetch" href="/assets/js/10.00c1caf2.js"><link rel="prefetch" href="/assets/js/11.22f75b2f.js"><link rel="prefetch" href="/assets/js/12.33618473.js"><link rel="prefetch" href="/assets/js/13.f5bcdba3.js"><link rel="prefetch" href="/assets/js/14.069ed78b.js"><link rel="prefetch" href="/assets/js/15.8ad5337f.js"><link rel="prefetch" href="/assets/js/16.27611e97.js"><link rel="prefetch" href="/assets/js/17.f0ee6d17.js"><link rel="prefetch" href="/assets/js/18.4a6eb331.js"><link rel="prefetch" href="/assets/js/19.43e4541f.js"><link rel="prefetch" href="/assets/js/20.7de46031.js"><link rel="prefetch" href="/assets/js/21.84669414.js"><link rel="prefetch" href="/assets/js/22.9afacd9c.js"><link rel="prefetch" href="/assets/js/23.f216dfdc.js"><link rel="prefetch" href="/assets/js/24.0cc96f6f.js"><link rel="prefetch" href="/assets/js/25.cbd514e8.js"><link rel="prefetch" href="/assets/js/26.7be766a8.js"><link rel="prefetch" href="/assets/js/27.c82f8665.js"><link rel="prefetch" href="/assets/js/28.14ff35c2.js"><link rel="prefetch" href="/assets/js/3.3c269ca0.js"><link rel="prefetch" href="/assets/js/30.eb394ebe.js"><link rel="prefetch" href="/assets/js/31.71b1efc9.js"><link rel="prefetch" href="/assets/js/32.a260662e.js"><link rel="prefetch" href="/assets/js/33.ebd1b0e9.js"><link rel="prefetch" href="/assets/js/34.8c89ccc9.js"><link rel="prefetch" href="/assets/js/35.8c56c023.js"><link rel="prefetch" href="/assets/js/36.bb77a714.js"><link rel="prefetch" href="/assets/js/37.fff25a6d.js"><link rel="prefetch" href="/assets/js/38.c898d862.js"><link rel="prefetch" href="/assets/js/39.3c1938ed.js"><link rel="prefetch" href="/assets/js/4.8ce84c45.js"><link rel="prefetch" href="/assets/js/40.08340174.js"><link rel="prefetch" href="/assets/js/41.022c4327.js"><link rel="prefetch" href="/assets/js/42.a6524d2e.js"><link rel="prefetch" href="/assets/js/43.8f0dd455.js"><link rel="prefetch" href="/assets/js/44.b23d9f65.js"><link rel="prefetch" href="/assets/js/45.a30b757b.js"><link rel="prefetch" href="/assets/js/46.789e9716.js"><link rel="prefetch" href="/assets/js/47.33d6f209.js"><link rel="prefetch" href="/assets/js/48.135250ff.js"><link rel="prefetch" href="/assets/js/49.3d6d3bb5.js"><link rel="prefetch" href="/assets/js/5.62e47b4c.js"><link rel="prefetch" href="/assets/js/50.44990f04.js"><link rel="prefetch" href="/assets/js/51.2a2a5129.js"><link rel="prefetch" href="/assets/js/52.3996bfd7.js"><link rel="prefetch" href="/assets/js/53.01d6e216.js"><link rel="prefetch" href="/assets/js/54.ec31b688.js"><link rel="prefetch" href="/assets/js/55.25e75232.js"><link rel="prefetch" href="/assets/js/6.83a6b4a3.js"><link rel="prefetch" href="/assets/js/7.1f83f4dc.js"><link rel="prefetch" href="/assets/js/8.db84d1e9.js"><link rel="prefetch" href="/assets/js/9.6259a5ab.js">
    <link rel="stylesheet" href="/assets/css/0.styles.454f99c0.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-navbar"><!----> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/" class="sidebar-link">首页</a></li><li><a href="/api/" class="sidebar-link">扩展 API</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="virtual-documents"><a href="#virtual-documents" aria-hidden="true" class="header-anchor">#</a> Virtual Documents</h1> <p>The text document content provider API allows you to create readonly documents in Visual Studio Code from arbitrary sources. You can find a sample extension with source code at: https://github.com/Microsoft/vscode-extension-samples/blob/master/virtual-document-sample/README.md</p> <h2 id="textdocumentcontentprovider"><a href="#textdocumentcontentprovider" aria-hidden="true" class="header-anchor">#</a> TextDocumentContentProvider</h2> <p>The API works by claiming an uri-scheme for which your provider then returns text contents. The scheme must be provided when registering a provider and cannot change afterwards. The same provider can be used for multiple schemes and multiple providers can be registered for a single scheme.</p> <div class="language-ts extra-class"><pre class="language-ts"><code>vscode<span class="token punctuation">.</span>workspace<span class="token punctuation">.</span><span class="token function">registerTextDocumentContentProvider</span><span class="token punctuation">(</span>myScheme<span class="token punctuation">,</span> myProvider<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Calling <code>registerTextDocumentContentProvider</code> returns a disposable with which the registration can be undone. A provider must only implement the <code>provideTextDocumentContent</code>-function which is called with an uri and cancellation token.</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> myProvider <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token class-name">implements</span> vscode<span class="token punctuation">.</span>TextDocumentContentProvider <span class="token punctuation">{</span>
  <span class="token function">provideTextDocumentContent</span><span class="token punctuation">(</span>uri<span class="token punctuation">:</span> vscode<span class="token punctuation">.</span>Uri<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
    <span class="token comment">// simply invoke cowsay, use uri-path as text</span>
    <span class="token keyword">return</span> cowsay<span class="token punctuation">.</span><span class="token function">say</span><span class="token punctuation">(</span><span class="token punctuation">{</span> text<span class="token punctuation">:</span> uri<span class="token punctuation">.</span>path <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>Note how the provider doesn't create uris for virtual documents - its role is to <strong>provide</strong> contents given such an uri. In return, content providers are wired into the open document logic so that providers are always considered.</p> <p>This sample uses a 'cowsay'-command that crafts an uri which the editor should then show:</p> <div class="language-ts extra-class"><pre class="language-ts"><code>vscode<span class="token punctuation">.</span>commands<span class="token punctuation">.</span><span class="token function">registerCommand</span><span class="token punctuation">(</span><span class="token string">'cowsay.say'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> what <span class="token operator">=</span> <span class="token keyword">await</span> vscode<span class="token punctuation">.</span>window<span class="token punctuation">.</span><span class="token function">showInputBox</span><span class="token punctuation">(</span><span class="token punctuation">{</span> placeHolder<span class="token punctuation">:</span> <span class="token string">'cow say?'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>what<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> uri <span class="token operator">=</span> vscode<span class="token punctuation">.</span>Uri<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">'cowsay:'</span> <span class="token operator">+</span> what<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> doc <span class="token operator">=</span> <span class="token keyword">await</span> vscode<span class="token punctuation">.</span>workspace<span class="token punctuation">.</span><span class="token function">openTextDocument</span><span class="token punctuation">(</span>uri<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// calls back into the provider</span>
    <span class="token keyword">await</span> vscode<span class="token punctuation">.</span>window<span class="token punctuation">.</span><span class="token function">showTextDocument</span><span class="token punctuation">(</span>doc<span class="token punctuation">,</span> <span class="token punctuation">{</span> preview<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The command prompts for input, creates an uri of the <code>cowsay</code>-scheme, opens a document for the uri, and finally opens an editor for that document. In step 3, opening the document, the provider is being asked to provide contents for that uri.</p> <p>With this we have a fully functional text document content provider. The next sections describe how virtual documents can be updated and how UI commands can be registered for virtual documents.</p> <h3 id="update-virtual-documents"><a href="#update-virtual-documents" aria-hidden="true" class="header-anchor">#</a> Update Virtual Documents</h3> <p>Depending on the scenario virtual documents might change. To support that, providers can implement a <code>onDidChange</code>-event. It must be fired for an uri and the editor will then ask for the new contents - assuming the document is still in use.</p> <p>The <code>vscode.Event</code>-type defines the contract for eventing in VS Code. The easiest way to implement an event is <code>vscode.EventEmitter</code>, like so:</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> myProvider <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token class-name">implements</span> vscode<span class="token punctuation">.</span>TextDocumentContentProvider <span class="token punctuation">{</span>
  <span class="token comment">// emitter and its event</span>
  onDidChangeEmitter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">vscode<span class="token punctuation">.</span>EventEmitter</span><span class="token operator">&lt;</span>vscode<span class="token punctuation">.</span>Uri<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  onDidChange <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>onDidChangeEmitter<span class="token punctuation">.</span>event<span class="token punctuation">;</span>

  <span class="token comment">//...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>That's all what's needed to make VS code listen for changes of virtual document. The next section will add an editor action that uses the event emitter.</p> <h3 id="add-editor-commands"><a href="#add-editor-commands" aria-hidden="true" class="header-anchor">#</a> Add Editor Commands</h3> <p>To illustrate above change-event and to get more cowsay, an editor action is needed that reverses what the cow just said. First we need a command that does that:</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// register a command that updates the current cowsay</span>
subscriptions<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>
  vscode<span class="token punctuation">.</span>commands<span class="token punctuation">.</span><span class="token function">registerCommand</span><span class="token punctuation">(</span><span class="token string">'cowsay.backwards'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>vscode<span class="token punctuation">.</span>window<span class="token punctuation">.</span>activeTextEditor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token comment">// no editor</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">let</span> <span class="token punctuation">{</span> document <span class="token punctuation">}</span> <span class="token operator">=</span> vscode<span class="token punctuation">.</span>window<span class="token punctuation">.</span>activeTextEditor<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span>uri<span class="token punctuation">.</span>scheme <span class="token operator">!==</span> myScheme<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token comment">// not my scheme</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// get path-components, reverse it, and create a new uri</span>
    <span class="token keyword">let</span> say <span class="token operator">=</span> document<span class="token punctuation">.</span>uri<span class="token punctuation">.</span>path<span class="token punctuation">;</span>
    <span class="token keyword">let</span> newSay <span class="token operator">=</span> say
      <span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> newUri <span class="token operator">=</span> document<span class="token punctuation">.</span>uri<span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span><span class="token punctuation">{</span> path<span class="token punctuation">:</span> newSay <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> vscode<span class="token punctuation">.</span>window<span class="token punctuation">.</span><span class="token function">showTextDocument</span><span class="token punctuation">(</span>newUri<span class="token punctuation">,</span> <span class="token punctuation">{</span> preview<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The snippet above checks that we have an active editor and that its document is one of our scheme. These checks are needed because commands are available (and executable) to everyone. Then the path-component of the uri is reversed and a new uri is created from it, last an editor is opened.</p> <p>To top things with an editor command a declarative part in <code>package.json</code> is needed. In the <code>contributes</code>-section add this config:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token property">&quot;menus&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">&quot;editor/title&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;command&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cowsay.backwards&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;group&quot;</span><span class="token operator">:</span> <span class="token string">&quot;navigation&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;when&quot;</span><span class="token operator">:</span> <span class="token string">&quot;resourceScheme == cowsay&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>This references the <code>cowsay.backwards</code>-command that defined in the <code>contributes/commands</code>-section and says it should appear in the editor title menu (the toolbar in the upper right corner). Now, just that would mean the command always shows, for every editor. That's what the <code>when</code>-clause is used for - it describes what condition must be true to show the action. In this sample it states that the scheme of the document in the editor must be the <code>cowsay</code>-scheme. The configuration is then repeated for the <code>commandPalette</code>-menu - it shows all commands by default.</p> <p><img src="images/virtual-documents/cowsay-bwd.png" alt="cowsay-bwd"></p> <h3 id="events-and-visibility"><a href="#events-and-visibility" aria-hidden="true" class="header-anchor">#</a> Events and Visibility</h3> <p>Document providers are first class citizens in VS Code, their contents appears in regular text documents, they use the same infrastructure as files etc. However, that also means that &quot;your&quot; documents cannot hide, they will appear in <code>onDidOpenTextDocument</code> and <code>onDidCloseTextDocument</code>-events, they are part of <code>vscode.workspace.textDocuments</code> and more. The rule for everyone is check the <code>scheme</code> of documents and then decide if you want to do something with/for the document.</p> <h3 id="file-system-api"><a href="#file-system-api" aria-hidden="true" class="header-anchor">#</a> File System API</h3> <p>If you need more flexibility and power take a look at the <a href="/api/references/vscode-api#FileSystemProvider"><code>FileSystemProvider</code></a> API. It allows to implement a full file system, having files, folders, binary data, file-deletion, creation and more.</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.69530766.js" defer></script><script src="/assets/js/2.6081b710.js" defer></script><script src="/assets/js/29.0b9194ef.js" defer></script>
  </body>
</html>
