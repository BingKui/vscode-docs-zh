<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Task Provider | Hello VuePress</title>
    <meta name="description" content="Just playing around">
    
    
    <link rel="preload" href="/vscode-doc-zh/assets/css/0.styles.0c09eec2.css" as="style"><link rel="preload" href="/vscode-doc-zh/assets/js/app.79cc50a5.js" as="script"><link rel="preload" href="/vscode-doc-zh/assets/js/2.6081b710.js" as="script"><link rel="preload" href="/vscode-doc-zh/assets/js/26.9406d5cd.js" as="script"><link rel="prefetch" href="/vscode-doc-zh/assets/js/10.dcf0234a.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/11.3443e88c.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/12.33618473.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/13.f5bcdba3.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/14.069ed78b.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/15.8ad5337f.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/16.27611e97.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/17.ae2dc47b.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/18.4a6eb331.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/19.17a60d3f.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/20.7de46031.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/21.84669414.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/22.9afacd9c.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/23.f216dfdc.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/24.0cc96f6f.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/25.be98c8b0.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/27.c82f8665.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/28.14ff35c2.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/29.0b9194ef.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/3.3c269ca0.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/30.6c266e85.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/31.71b1efc9.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/32.a260662e.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/33.ebd1b0e9.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/34.8c89ccc9.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/35.8c56c023.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/36.bb77a714.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/37.fff25a6d.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/38.c898d862.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/39.2754f4ea.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/4.8ce84c45.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/40.08340174.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/41.022c4327.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/42.a6524d2e.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/43.8f0dd455.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/44.b23d9f65.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/45.04fcf627.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/46.789e9716.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/47.33d6f209.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/48.135250ff.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/49.3d6d3bb5.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/5.62e47b4c.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/50.44990f04.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/51.6ca0374b.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/52.eb83c9e0.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/53.9a022f02.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/54.7da689eb.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/55.25e75232.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/6.83a6b4a3.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/7.eefd45de.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/8.aa200fb5.js"><link rel="prefetch" href="/vscode-doc-zh/assets/js/9.6259a5ab.js">
    <link rel="stylesheet" href="/vscode-doc-zh/assets/css/0.styles.0c09eec2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-navbar"><!----> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/vscode-doc-zh/" class="sidebar-link">首页</a></li><li><a href="/vscode-doc-zh/api/" class="sidebar-link">扩展 API</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="task-provider"><a href="#task-provider" aria-hidden="true" class="header-anchor">#</a> Task Provider</h1> <p>Users normally define <a href="/docs/editor/tasks">tasks</a> in Visual Studio Code in a <code>tasks.json</code> file. However, there are some tasks during software development that can be automatically detected by a VS Code extension with a Task Provider. When the <strong>Tasks: Run Task</strong> command is run from VS Code, all active Task Providers contribute tasks that the user can run. While the <code>tasks.json</code> file lets the user manually define a task for a specific folder or workspace, a Task Provider can detect details about a workspace and then automatically create a corresponding VS Code Task. For example, a Task Provider could check if there is a <code>make</code> file and create a build task. This topic describes how extensions can auto-detect and provide tasks to end-users.</p> <p>This guide teaches you how to build a Task Provider that auto-detects tasks defined in <a href="https://ruby.github.io/rake/" target="_blank" rel="noopener noreferrer">Rakefiles<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. The complete source code is at: https://github.com/Microsoft/vscode-extension-samples/tree/master/task-provider-sample.</p> <h2 id="task-definition"><a href="#task-definition" aria-hidden="true" class="header-anchor">#</a> Task Definition</h2> <p>To uniquely identify a task in the system, an extension contributing a task needs to define the properties that identify a task. In the Rake example, the task definition looks like this:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token property">&quot;taskDefinitions&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;rake&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;required&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token string">&quot;task&quot;</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">&quot;properties&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;task&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;The Rake task to customize&quot;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">&quot;file&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;The Rake file that provides the task. Can be omitted.&quot;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><p>This contributes a task definition for <code>rake</code> tasks. The task definition has two attributes <code>task</code> and <code>file</code>. <code>task</code> is the name of the Rake task and <code>file</code> points to the <code>Rakefile</code> that contains the task. The <code>task</code> property is required, the <code>file</code> property is optional. If the <code>file</code> attribute is omitted, the <code>Rakefile</code> in the root of the workspace folder is used.</p> <h2 id="task-provider-2"><a href="#task-provider-2" aria-hidden="true" class="header-anchor">#</a> Task provider</h2> <p>Analogous to language providers that let extensions support code completion, an extension can register a task provider to compute all available tasks. This is done using the <code>vscode.tasks</code> namespace as shown in the following code snippet:</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> vscode <span class="token keyword">from</span> <span class="token string">'vscode'</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> rakePromise<span class="token punctuation">:</span> Thenable<span class="token operator">&lt;</span>vscode<span class="token punctuation">.</span>Task<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token operator">|</span> undefined <span class="token operator">=</span> undefined<span class="token punctuation">;</span>
<span class="token keyword">const</span> taskProvider <span class="token operator">=</span> vscode<span class="token punctuation">.</span>tasks<span class="token punctuation">.</span><span class="token function">registerTaskProvider</span><span class="token punctuation">(</span><span class="token string">'rake'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">provideTasks</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>rakePromise<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      rakePromise <span class="token operator">=</span> <span class="token function">getRakeTasks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> rakePromise<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">resolveTask</span><span class="token punctuation">(</span>_task<span class="token punctuation">:</span> vscode<span class="token punctuation">.</span>Task<span class="token punctuation">)</span><span class="token punctuation">:</span> vscode<span class="token punctuation">.</span>Task <span class="token operator">|</span> undefined <span class="token punctuation">{</span>
		<span class="token keyword">const</span> task <span class="token operator">=</span> _task<span class="token punctuation">.</span>definition<span class="token punctuation">.</span>task<span class="token punctuation">;</span>
		<span class="token comment">// A Rake task consists of a task and an optional file as specified in RakeTaskDefinition</span>
		<span class="token comment">// Make sure that this looks like a Rake task by checking that there is a task.</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>task<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// resolveTask requires that the same definition object be used.</span>
			<span class="token keyword">const</span> definition<span class="token punctuation">:</span> RakeTaskDefinition <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;</span>_task<span class="token punctuation">.</span>definition<span class="token punctuation">;</span>
			<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">vscode<span class="token punctuation">.</span>Task</span><span class="token punctuation">(</span>definition<span class="token punctuation">,</span> definition<span class="token punctuation">.</span>task<span class="token punctuation">,</span> <span class="token string">'rake'</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">vscode<span class="token punctuation">.</span>ShellExecution</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">rake </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>definition<span class="token punctuation">.</span>task<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> undefined<span class="token punctuation">;</span>  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Like <code>provideTasks</code>, the <code>resolveTask</code> method is called by VS Code to get tasks from the extension. <code>resolveTask</code> is called <em><strong>after</strong></em> <code>provideTasks</code>, and is intended to provide an optional performance increase for providers that implement it but don't provide tasks from <code>provideTasks</code>. It is good practice to have a setting that allows users to turn off individual task providers, so this is common. A user might notice that tasks from a specific provider are slower to get and turn off the provider. In this case, the user might still reference some of the tasks from this provider in their <code>tasks.json</code>. If <code>resolveTask</code> is not implemented, then there will be a warning that the task in their <code>tasks.json</code> was not created. With <code>resolveTask</code> an extension can still provide a task for the task defined in <code>tasks.json</code>.</p> <p>The <code>getRakeTasks</code> implementation does the following:</p> <ul><li>Lists all rake tasks defined in a <code>Rakefile</code> using the <code>rake -AT -f Rakefile</code> command.</li> <li>Parses the stdio output.</li> <li>For every listed task, creates a <code>vscode.Task</code> implementation.</li></ul> <p>Since a Rake task instantiation needs a task definition as defined in the <code>package.json</code> file, VS Code also defines the structure using a TypeScript interface like this:</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">interface</span> <span class="token class-name">RakeTaskDefinition</span> <span class="token keyword">extends</span> <span class="token class-name">vscode<span class="token punctuation">.</span>TaskDefinition</span> <span class="token punctuation">{</span>
  <span class="token comment">/**
   * The task name
   */</span>
  task<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>

  <span class="token comment">/**
   * The rake file containing the task
   */</span>
  file<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Assuming that the output comes from a task called <code>compile</code>, the corresponding task creation then looks like this:</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">let</span> task <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">vscode<span class="token punctuation">.</span>Task</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span> <span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token string">'rake'</span><span class="token punctuation">,</span> task<span class="token punctuation">:</span> <span class="token string">'compile'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">'compile'</span><span class="token punctuation">,</span>
  <span class="token string">'rake'</span><span class="token punctuation">,</span>
  <span class="token keyword">new</span> <span class="token class-name">vscode<span class="token punctuation">.</span>ShellExecution</span><span class="token punctuation">(</span><span class="token string">'rake compile'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>For every task listed in the output, a corresponding VS Code task is created using the above pattern and then returns the array of all tasks from the <code>getRakeTasks</code> call.</p> <p>The <code>ShellExecution</code> executes the <code>rake compile</code> command in the shell that is specific for the OS (for example under Windows the command would be executed in PowerShell, under Ubuntu it'd be executed in bash). If the task should directly execute a process (without spawning a shell), <code>vscode.ProcessExecution</code> can be used. <code>ProcessExecution</code> has the advantage that the extension has full control over the arguments passed to the process. Using <code>ShellExecution</code> makes use of the shell command interpretation (like wildcard expansion under bash). If the <code>ShellExecution</code> is created with a single command line, then the extension needs to ensure proper quoting and escaping (for example to handle whitespace) inside the command.</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/vscode-doc-zh/assets/js/app.79cc50a5.js" defer></script><script src="/vscode-doc-zh/assets/js/2.6081b710.js" defer></script><script src="/vscode-doc-zh/assets/js/26.9406d5cd.js" defer></script>
  </body>
</html>
